<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Nossa Cafeteria</title>
    <link rel="stylesheet" href="/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Gravitas+One&family=Pacifico&family=Unlock&display=swap" rel="stylesheet">
</head>
<body>

    <!--Cabeçalho-->
    <header>
        <section>
            <div class="container">
                <div class="banner">
                    <img src="/imagens/Cabeçalho.png">
                </div>

                <div class="bannerresponsivo">
                    <img src="/imagens/CabeçalhoResponsivo.png">
                </div>
            </div>
        </section>
    </header>

    <!--Itens do Cardápio-->
    <div class="cardapio-container">
        <div class="cardapio-type">
            <h2>Salgados</h2>
        </div>

        <div id="salgados-list"></div>
    </div>

    <div class="cardapio-container">
        <div class="cardapio-type">
            <h2>Sanduíches</h2>
        </div>

        <div id="sanduiches-list"></div>
    </div>

    <button class="add-button" id="add-button">ADICIONAR</button>

    <!-- Menu para adicionar novos itens -->
    <div id="add-menu" class="add-menu hidden">
        <h2>Adicionar Novo Item</h2>
        <label for="itemNome">Nome:</label>
        <input type="text" id="itemNome" placeholder="Digite o nome do item" required>
        
        <label for="itemPreco">Preço:</label>
        <input type="number" id="itemPreco" placeholder="Digite o preço do item" step="0.01" required>
        
        <label for="itemDescricao">Descrição:</label>
        <textarea id="itemDescricao" placeholder="Digite a descrição do item"></textarea>
        
<<<<<<< HEAD
        <label for="itemDestino">Lista:</label>
        <select id="itemDestino">
            <option value="salgados-list">Salgados</option>
            <option value="sanduiches-list">Sanduíches</option>
=======
        <label for="itemQual">Tipo:</label>
        <select id="itemQual" placeholder="Selecione o tipo de item">
            <option value="Salgado">Salgados</option>
            <option value="Sanduiche">Sanduiche</option>

        </select>
        
        <button id="save-button" class="save-button">SALVAR</button>
        <button id="cancel-button" class="cancel-button">CANCELAR</button>
    </div>

</body>

<script>
    // Função para carregar os itens de ambas as listas ao carregar a página
    function carregarDados() {
        const endpoints = [
            { api: "/salgados/api", listId: "salgados-list" },
            { api: "/sanduiches/api", listId: "sanduiches-list" }
        ];

        endpoints.forEach(({ api, listId }) => {
            fetch(api)
                .then(response => response.json())
                .then(data => {
                    const container = document.getElementById(listId);
                    container.innerHTML = "";

                    data.forEach(item => {
                        adicionarItemNaLista(container, item);
                    });
                })
                .catch(error => console.error(`Erro ao carregar itens de ${api}:`, error));
        });
    }

    // Função para criar um item na lista
    function adicionarItemNaLista(container, item) {
        const cardapioItem = document.createElement("div");
        cardapioItem.classList.add("cardapio-item");

        const itemDetails = document.createElement("div");
        itemDetails.classList.add("item-details");

        const itemNome = document.createElement("h3");
        itemNome.innerHTML = `${item.nome} <span class="price">R$ ${item.preco.toFixed(2)}</span>`;

        const itemDescricao = document.createElement("p");
        itemDescricao.textContent = item.tipo;

        const orderButton = document.createElement("div");
        orderButton.classList.add("order-button");

        const editButton = document.createElement("button");
        editButton.classList.add("edit-button");
        editButton.textContent = "EDITAR";

        const deleteButton = document.createElement("button");
        deleteButton.classList.add("delete-button");
        deleteButton.textContent = "EXCLUIR";

        // Adiciona eventos aos botões
        editButton.addEventListener("click", () => editarItem(item));
        deleteButton.addEventListener("click", () => excluirItem(item));

        itemDetails.appendChild(itemNome);
        itemDetails.appendChild(itemDescricao);
        orderButton.appendChild(editButton);
        orderButton.appendChild(deleteButton);
        cardapioItem.appendChild(itemDetails);
        cardapioItem.appendChild(orderButton);
        container.appendChild(cardapioItem);
    }

    // Função para excluir um item
    function excluirItem(item) {
        fetch("/excluir", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ id: item.id })
        })
        .then(response => {
            if (response.ok) {
                alert("Item excluído com sucesso.");
                carregarDados();
            } else {
                console.error("Erro ao excluir o item:", response.statusText);
            }
        })
        .catch(error => console.error("Erro ao excluir o item:", error));
    }

    // Função para adicionar novo item ao backend
    function adicionarNovoItem() {
        const nome = document.getElementById("itemNome").value;
        const preco = parseFloat(document.getElementById("itemPreco").value);
        const descricao = document.getElementById("itemDescricao").value;
        const destino = document.getElementById("itemDestino").value;
        const apiEndpoint = destino === "salgados-list" ? "/salgados/salvar" : "/sanduiches/salvar";

        if (nome && !isNaN(preco) && descricao) {
            fetch(apiEndpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ nome, preco, tipo: descricao })
            })
            .then(response => {
                if (response.ok) {
                    alert("Item adicionado com sucesso.");
                    document.getElementById("add-menu").classList.add("hidden");
                    carregarDados();
                } else {
                    console.error("Erro ao adicionar o item:", response.statusText);
                }
            })
            .catch(error => console.error("Erro ao adicionar o item:", error));
        } else {
            alert("Preencha todos os campos corretamente.");
        }
    }

    // Configuração de eventos para os botões
    document.getElementById("add-button").addEventListener("click", () => {
        document.getElementById("add-menu").classList.remove("hidden");
    });

    document.getElementById("cancel-button").addEventListener("click", () => {
        document.getElementById("add-menu").classList.add("hidden");
        document.getElementById("itemNome").value = "";
        document.getElementById("itemPreco").value = "";
        document.getElementById("itemDescricao").value = "";
        document.getElementById("itemDestino").value = "salgados-list";
    });

    document.getElementById("save-button").addEventListener("click", adicionarNovoItem);

    // Carrega os dados ao carregar a página
    document.addEventListener("DOMContentLoaded", carregarDados);
</script>
</html>
